#include "common.h"

typedef struct {
	uint8_t red;
	uint8_t green;
	uint8_t blue;
} rgb_t;

const rgb_t palette[0x10] = {
//       R,    G,    B
	{0x00, 0x00, 0x00},
	{0x00, 0x00, 0x2a},
	{0x00, 0x2a, 0x00},
	{0x00, 0x2a, 0x2a},
	{0x2a, 0x00, 0x00},
	{0x2a, 0x00, 0x2a},
	{0x2a, 0x15, 0x00},
	{0x2a, 0x2a, 0x2a},
	{0x15, 0x15, 0x15},
	{0x15, 0x15, 0x3f},
	{0x15, 0x3f, 0x15},
	{0x15, 0x3f, 0x3f},
	{0x3f, 0x15, 0x15},
	{0x3f, 0x15, 0x3f},
	{0x3f, 0x3f, 0x15},
	{0x3f, 0x3f, 0x3f}
};

void attr_configure(void){
	cli();
	for(int i=0; i<0x10; i++){
		out_port(0x3c0, i);
		out_port(0x3c1, i);
	}
	sti();
}

void dac_configure(void){
	cli();
	out_port(0x3c8, 0);
	for(int i=0; i<0x10; i++){
		out_port(0x3c9, palette[i].red);
		out_port(0x3c9, palette[i].green);
		out_port(0x3c9, palette[i].blue);
	}
	sti();
}

void load_font(void *font){
	for(int i=0; i<0x1000; i+=4){
		uint32_t v = *(uint32_t*)(font+i);
		write_esd((uint32_t*)i, v);
	}
}
